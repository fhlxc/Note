# 质量专项培训第二天
## 客户端专项测试
### 1. 什么是客户端专项测试
- - -
- 客户端概念：与服务器对应，为客户提供本地服务的程序
- 专项测试概念：对某个模块、功能、性能等进行专门的针对性的全面测试
- 目的：针对客户端特性问题，引入
- - -
### 2. 建设过程
- - -
- 反馈系统：建立监控及反馈能力。分析反馈问题、日志
- 底线目标：确定指标要求。如crash率、响应时间
- 解决问题：为了达到目标行动
- 持续闭环：回到反馈系统展示
- 专项测试技能
    - 发现问题（测试技能）：主要是测试技能和专项技能的辅助，一个专项测试，要懂得基于可预见的风险去测试对应的场景
        - 快速熟悉业务的能力
        - 测试场景与用例制定
        - 熟悉用户行为与心理
    - 分析问题（专项技能）：定位问题原因以及问题解决。积累问题的解决方法和分析过程，增加问题分析自信心
        - 熟悉操作系统和加算计网络原理
        - 熟悉不同专项问题的原因及解决办法
        - 深挖问题的意识
    - 推动问题（通用技能）：大部人很难意识到专项风险对产品带来的灾难有多大。技术层面和产品层面两种推动方向。需要具备严密的思维逻辑和成熟的沟通能力
        - 沟通能力与谈判技巧
        - 结构思维及逻辑思路
- 客户端专项测试体系
    - 性能：启动、页面加载、流畅度、耗电、过度绘制
    - 兼容性：OS、分辨率、横竖屏、多语言、ROM
    - 稳定性：monkey、智能遍历、内存泄漏、接口异常、弱网
    - 其他：升级安装、安全、环境干扰、安装包大小、埋点
- 专项测试手段
    - 自动化测试：测试执行重复性工作，测试执行过程复用性高，测试执行高频
    - 手工测试：重复工作少，测试执行可复用部分少，测试执行低频
    - 工具开发：无现成可用工具，当前工具无法满足测试要求，充分调研，避免重复造轮子
- 客户端性能测试（[Android深度性能测试](https://km.sankuai.com/page/196704545) [客户端性能测试](https://km.sankuai.com/page/182836441)）
    - 测试指标
        - 确定性能指标
            - 启动时间
                - 冷启动：后台没有该应用进程，启动应用需要重新创建进程
                - 热启动：后台已有该应用进程，启动应用从已有进程中启动
                - 首次启动：首次安装或者清除数据后启动，没有完成系统初始化
                - adb测试启动时间方法：adb shell am start -W <packageName>/packageName.MainActivity
                    - -W：等待启动完成
                    - ThisTime：最后一个启动的Activity的启动耗时
                    - TotalTime：自己的所有Activity的启动耗时
                    - WaitTime：ActivityManagerService启动App的Activity时的总时间（包括当前Activity的onPause()和自己的Activity的启动）
            - 页面加载时间
                - 录频分帧测试方法：点击图标/按钮，录制点击操作到页面静止的过程视频。视频第一帧变动到目标页面展现第一帧为启动时间
            - 流畅度
                - adb指令：adb shell dumpsys gfxinfo <packageName>
            - CPU
                - 过度绘制：A和B两个元素，A完全挡住了B，呈现在UI上，GPU会先绘制B，再绘制A，如此，便多绘制了一遍
                    - 浪费CPU&GPU资源
                    - APP卡顿
                    - 耗电增加
                    - 测试策略
                        - APP全面覆盖测试
                        - 页面加载关闭
                        - 定期回归测试
                        - 新增页面测试
            - 内存
        - 确定个指标通过标准
        - 性能测试报告（[性能测试报告文档](https://qa.sjst.test.sankuai.com/tool/performance_report_list)）
    - 测试场景
        - 确定测试场景
        - 设计测试用例
    - 测试方法
        - 测试工具选型
        - 工具效果分析
    - 运营优化
        - 结果分析
        - 推动问题解决
- 稳定性测试（数据来源：[崩溃数据](https://crash.sankuai.com)）
    - 目的：尽早、尽可能多的发现Crash及ANR问题
    - 关键指标：崩溃率 <= 1%（Ceash次数 / DAU每个用户崩溃多少次）
    - crash：停止运行/闪退
    - ANR：无响应
    - 测试方法（[谷歌monkey工具](https://km.sankuai.com/page/29938854) [云测平台稳定性测试](http://conan.sankuai.com)）
        - Monkey测试：通过注入随机事件模拟猴子长时间胡乱操作APP，看看什么时候会出现crash等问题，属于对APP进行压力测试
            - 关键逻辑小按钮操作概率低：进入页面按区域权重控制随机事件操作坐标
            - 卡死在某个页面：进入页面按照固定脚本配置执行操作
        - 遍历测试：根据深度优先或广度优先算法遍历点击页面中的元素，尽可能多的点击元素发现异常，可以发现非主流程场景逻辑按钮必现crash等问题
            - 基于appium，同时支持Android和iOS，同时支持Native和Hybrid
            - 按深度优先（DFS）算法执行遍历
            - 通过配置文件控制遍历行为
            - 速度相对较慢
            - 问题：
                - 无法重复点击，导航无法遍历完整
                - 弹窗一次性生命周期，队列不能清空
                - 返回键默认返回上一个activity，不能返回上一个布局页
            - 测试指标
                - 遍历覆盖率
                - 完成事件 数 / 小时
    - 其他测试
        - 网络异常：网络限速、丢包、请求失败、返回超时（[弱网测试](https://km.sankuai.com/page/29889405)）
            - 弱网测试目的：
                - 模拟App在不同的网络情况，检查App是否会有crash、卡死、闪退、无响应等各种异常情况
                - 验证APP是否有超时处理、失败重试等机制处理
                - 测试心跳连接、轮询机制、长链接在不同网络环境下带来的性能体验
            - 弱网测试方法：
                - 抓包工具Charles/fiddler
                - iOS开发者工具
                - 路由器限速
        - 接口异常：接口mock注入异常、注入返回异常数据
            - 手工测试：[Charles断点使用](https://km.sankuai.com/page/117382163)
            - 自动化测试：[appmock平台（要求RD修改代码）](https://appmock.sankuai.com)
        - 内存泄漏：内存泄漏工具LeakCanary、Memory Monitor...
            - 定义：程序中已动态分配的堆内存由于某种原因程序未释放或无法释放，造成系统内存的浪费，导致程序运行速度减慢甚至系统崩溃等严重后果
            - 工具：[Android LeakCanary](https://square.github.io/leakcanary/)
- - -